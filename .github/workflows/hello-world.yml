name: Close PR

on:
  pull_request:
    types: [opened]

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  close_pr:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Close PR
      run: |
        REPO_NAME=$(jq -r .repository.name <<< "$GITHUB_EVENT_PATH")
        PR_NUMBER=$(jq -r .pull_request.number <<< "$GITHUB_EVENT_PATH")

        echo "Closing PR #$PR_NUMBER"
        curl -sSL \
          -H "Authorization: token $GITHUB_TOKEN" \
          -H "Accept: application/vnd.github+json" \
          -X PATCH \
          -d '{"state": "closed"}' \
          "https://api.github.com/repos/$GITHUB_REPOSITORY/pulls/$PR_NUMBER"
